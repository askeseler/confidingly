import React from "react";
import './Main.css';
import InfoPage from './components/InfoPage.js'
import Registration from './components/Registration.js'

import Login from "./components/Login.js";
import user from './icons/user.svg';
import map from './icons/map.svg';
import search from './icons/search.svg';
import star from './icons/star.svg';
import list from './icons/list.svg';
import plus from './icons/plus.svg';
import coworking from './icons/coworking.png';

class Main extends React.Component {
    constructor(props) {
      super(props)
      this.default_page = ""//SET THIS PAGE
      this.state = { page: this.default_page, loginOpen: false, loggedIn: false }
      this.loginOrRedirect = this.loginOrRedirect.bind(this);
    }
  
    componentDidMount() {
      // Prevent navigation via href. Change url instead manually and update state.page for conditional rendering.
      //this.setState({page: window.location.href});
      let page = new URL(window.location.href).pathname.slice(1)
      if (page == "") page = this.default_page;
      this.setState({ page: page });
  
      window.block_navigation = true;
      
      window.addEventListener("popstate", (event) => {  
        if (window.block_navigation) {
          event.preventDefault();
          let new_slug = new URL(event.destination.url).pathname;
          window.block_navigation = false;
          window.history.pushState('', document.title, new_slug);
          window.block_navigation = true;
          this.setState({ page: new_slug.slice(1) })
        };
      });
    }

    loginOrRedirect(page){
      alert(this.state.loggedIn);
        if(!this.state.loggedIn){
            this.setState({ loginOpen: true});
        };
        this.setState({page:page})
    }
  
    mobile_version() {
        return (
          <div className="container">
            <div className="Header"></div>
            <div className="Content">
              {this.state.page === "" ? <InfoPage /> : <div/>}
              {this.state.page === "registration" ? <Registration /> : <div/>}
            </div>
            <div className="UserIcon">
              <Login
                userIcon={user}
                loginOpen={this.state.loginOpen}
                setLoginOpen={(x) => this.setState({ loginOpen: x})}
                setLoggedIn={(x) => this.setState({loggedIn: x})}
              />
            </div>
            <div className="AppIcon">
              <div>
                <img src={coworking} alt="Coworking Icon" />
              </div>
            </div>
            <div className="AppIconLarge">
              <div>coworkingfriendly.com</div>
            </div>
            <div className="Menu1">
              <div onClick={()=>this.loginOrRedirect("map")}>
                <div>
                  <img src={map} alt="Map Icon" />
                </div>
                <div>Map</div>
              </div>
            </div>
            <div className="Menu2">
            <div onClick={()=>this.loginOrRedirect("list")}>
            <div>
                  <img src={list} alt="List Icon" />
                </div>
                <div>List</div>
              </div>
            </div>
            <div className="Menu3">
              <div onClick={()=>this.loginOrRedirect("add")}>
                <div>
                  <img src={plus} alt="Add Icon" />
                </div>
                <div>Add</div>
              </div>
            </div>
            <div className="Menu4">
            <div onClick={()=>this.loginOrRedirect("recommended")}>
            <div>
                  <img src={star} alt="Recommended Icon" />
                </div>
                <div>Recommended</div>
              </div>
            </div>
            <div className="Menu5">
            <div onClick={()=>this.loginOrRedirect("search")}>
            <div>
                  <img src={search} alt="Search Icon" />
                </div>
                <div>Search</div>
              </div>
            </div>
          </div>
        );
      }
      
      desktop_version(){
        return <div className="centered-div">{this.mobile_version()}</div>
        }
    
      render() {
        if(window.mobile)return <div className="mobile-div">{this.mobile_version()}</div>;
        else return this.desktop_version();
      }
}

export default Main;